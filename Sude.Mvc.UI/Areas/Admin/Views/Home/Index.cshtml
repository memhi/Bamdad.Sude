@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using Microsoft.AspNetCore.Http;
@inject IHttpContextAccessor HttpContextAccessor


@{
  

    HttpContextAccessor.HttpContext.Session.SetActiveMenuItemSystemName("Dashboard");
    ViewBag.PageTitle = @_SudeSessionContext.GetLocalResourceValue("Page.Title.Dashboard");
}

<script src="~/AdminLTE/bower_components/chart.js/Chart.min.js"></script>
<input id="txtCurrentName" type="hidden" value="@_SudeSessionContext.CurrentWorkName" />
<input id="txtWorksCount" type="hidden" value="@(_SudeSessionContext.UserWorks!=null ?  _SudeSessionContext.UserWorks.Count():0)" />
   
<div class="row">
    <div class="col-md-12">
        <div class="box box-info " id="news-box">
            <div class="box-header with-border clearfix">
                <div class="box-title">
                    <i class="fa fa-newspaper-o"></i>
                    
                    @_SudeSessionContext.GetLocalResourceValue("Page.Content.SystemNews")
                </div>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="panel panel-info">
                            <div class="panel-heading clearfix">
                                <a class="pull-right" href='Home'>@_SudeSessionContext.GetLocalResourceValue("Page.Content.NewOptions")</a>
                            </div>
                            <div class="panel-body">
                                @_SudeSessionContext.GetLocalResourceValue("Page.Content.YearlyStatisticsReport")                                
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-info">
                            <div class="panel-heading clearfix">
                                <a class="pull-right" href='Home'>  </a>
                            </div>
                            <div class="panel-body">
                                @_SudeSessionContext.GetLocalResourceValue("Page.Content.SupportContact")
                                
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-info">
                            <div class="panel-heading clearfix">
                                
                                <a class="pull-right" href='Home'> @_SudeSessionContext.GetLocalResourceValue("Page.Content.SystemHelp")</a>
                            </div>
                            <div class="panel-body">
                                @_SudeSessionContext.GetLocalResourceValue("Page.Content.SystemHelpLink")
                                
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">

        <div class="box box-info " id="statistics-box">
            <div class="box-header with-border clearfix">
                <div class="box-title">
                    <i class="fa ion-stats-bars"></i>
                    
                    @_SudeSessionContext.GetLocalResourceValue("Page.Content.Statistics")
                </div>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="col-lg-3 col-xs-6">
                    <div class="small-box bg-olive">
                        <div class="inner">
                            <h4>@String.Format("{0:n0}", Convert.ToDouble(ViewData[Constants.ViewBagNames.OrderCount]))</h4>
                            <p>
                                @_SudeSessionContext.GetLocalResourceValue("Page.Content.OrderSell")
                            </p>

                        </div>
                        <div class="icon">
                            <i class="fa fa-shopping-cart"></i>

                        </div>
                        <a class="small-box-footer" href="Order">

                            @_SudeSessionContext.GetLocalResourceValue("Page.Content.MoreInformation")
                            <i class="fa fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-xs-6">
                    <div class="small-box bg-green-gradient">
                        <div class="inner">
                            <h4>@String.Format("{0:n0}", Convert.ToDouble(ViewData[Constants.ViewBagNames.SumOrderPrice]))</h4>
                            <p>
                                @_SudeSessionContext.GetLocalResourceValue("Page.Content.SellPrice")

                               
                            </p>
                        </div>
                        <div class="icon">
                            <i class="fa fa-money"></i>
                        </div>
                        <a class="small-box-footer" href="Order">
                      
                            @_SudeSessionContext.GetLocalResourceValue("Page.Content.MoreInformation")
                            <i class="fa fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>


                <div class="col-lg-3 col-xs-6">
                    <div class="small-box bg-blue">
                        <div class="inner">
                            <h4>@String.Format("{0:n0}", Convert.ToDouble(ViewData[Constants.ViewBagNames.OrderBuyCount]))</h4>

                            <p> @_SudeSessionContext.GetLocalResourceValue("Page.Content.OrderBuy")</p>

                        </div>

                        <div class="icon">
                            <i class="fa fa-shopping-cart"></i>

                        </div>
                        <a class="small-box-footer" href="Order">
                            @_SudeSessionContext.GetLocalResourceValue("Page.Content.MoreInformation")
                            <i class="fa fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>

                <div class="col-lg-3 col-xs-6">
                    <div class="small-box bg-light-blue-gradient">
                        <div class="inner">
                            <h4>@String.Format("{0:n0}", Convert.ToDouble(ViewData[Constants.ViewBagNames.SumOrderBuyPrice]))</h4>

                            <p> @_SudeSessionContext.GetLocalResourceValue("Page.Content.BuyPrice")</p>

                        </div>

                        <div class="icon">
                            <i class="fa fa-money"></i>

                        </div>
                        <a class="small-box-footer" href="Order">
                            @_SudeSessionContext.GetLocalResourceValue("Page.Content.MoreInformation")
                            <i class="fa fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>



            </div>
        </div>




    </div>
</div>



<div class="row">
    <div class="col-md-8">

        <div class="box box-info " id="latest-orders-box">
            <div class="box-header with-border">
                <h3 class="box-title">
                    <i class="fa fa-cart-plus"></i>
                    
                    @_SudeSessionContext.GetLocalResourceValue("Page.Content.LastOrders")
                <a class="btn btn-xs btn-info btn-flat margin-l-10" href="Order"> @_SudeSessionContext.GetLocalResourceValue("Page.Content.ShowAllOrders")</a>
                </h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <script>

            </script>
            <div class="box-body">
                <table class="table table-bordered table-hover table-striped dataTable" width="100%" height="300px" id="orders-grid">
                </table>


            </div>
        </div>
    </div>
    <div class="col-md-4">

        <div class="box box-info" id="order-statistics-box">
            <div class="box-header with-border">
                <h3 class="box-title">
                    <i class="fa fa-shopping-cart"></i>
                    @_SudeSessionContext.GetLocalResourceValue("Page.Content.Orders")
                </h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-xs btn-info btn-flat margin-r-5" data-chart-role="toggle-chart" onclick="changeType('year')" data-chart-period="year"> @_SudeSessionContext.GetLocalResourceValue("Page.Button.Year")</button>
                    <button class="btn btn-xs btn-info btn-flat margin-r-5" data-chart-role="toggle-chart" data-chart-period="month" onclick="changeType('month')"> @_SudeSessionContext.GetLocalResourceValue("Page.Button.Month")</button>
                    <button class="btn btn-xs btn-info btn-flat" data-chart-role="toggle-chart" data-chart-period="week" onclick="changeType('week')"> @_SudeSessionContext.GetLocalResourceValue("Page.Button.Week")</button>
                    <button class="btn btn-box-tool margin-l-10" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="chart" style="height: 300px;">
                    <canvas id="order-statistics-chart" height="300"></canvas>
                </div>
            </div>
        </div>


    </div>

</div>
<script>

    $(document).ready(function () {
        //changeType('week');

        var currentworkname = $("#txtCurrentName").val();
        var userworkscount = $("#txtWorksCount").val();

        if (currentworkname == "" && parseInt(userworkscount) > 1) {

            ShowSetDefaultWork();
        }

    });
    var osConfig = {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: " @_SudeSessionContext.GetLocalResourceValue("Page.Content.OrderStatistics")",
                    fillColor: "rgba(60,141,188,0.9)",
                    strokeColor: "rgba(60,141,188,0.8)",
                    pointColor: "#3b8bba",
                    pointStrokeColor: "rgba(60,141,188,1)",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(60,141,188,1)",
                    borderColor: 'rgba(60, 141, 188, 0.7)',
                    backgroundColor: 'rgba(44, 152, 214, 0.5)',
                    pointBorderColor: 'rgba(37, 103, 142, 0.9)',
                    pointBackgroundColor: 'rgba(60, 141, 188, 0.4)',
                    pointBorderWidth: 1,
                    data: []
                }
            ]
        },
        options: {
            legend: {
                display: false
            },
            scales: {
                xAxes: [{
                    display: true,
                    ticks: {
                        userCallback: function (dataLabel, index) {
                            if (window.orderStatistics && window.orderStatistics.config.data.labels.length > 12) {
                                return index % 5 === 0 ? dataLabel : '';
                            }
                            return dataLabel;
                        }
                    }
                }],
                yAxes: [{
                    display: true,
                    ticks: {
                        userCallback: function (dataLabel, index) {
                            return (dataLabel ^ 0) === dataLabel ? dataLabel : '';
                        },
                        min: 0
                    }
                }]
            },
            showScale: true,
            scaleShowGridLines: false,
            scaleGridLineColor: "rgba(0,0,0,.05)",
            scaleGridLineWidth: 1,
            scaleShowHorizontalLines: true,
            scaleShowVerticalLines: true,
            bezierCurve: true,
            pointDot: false,
            pointDotRadius: 4,
            pointDotStrokeWiioldth: 1,
            pointHitDetectionRadius: 20,
            datasetStroke: true,
            datasetFill: true,
            maintainAspectRatio: false,
            responsive: true
        }
    };

    function changeType(type) {
        var osLabels = [];
        var osData = [];

        $.ajax({
            cache: false,
            type: "GET",
            url: "Order/GetOrdersStatistics/",
            data: {
                statisticsType: type
            },
            success: function (data, textStatus, jqXHR) {
                for (var i = 0; i < data.length; i++) {
                    osLabels.push(data[i].date);

                    osData.push(data[i].value);
                }

                //  if (!window.orderStatistics) {

                osConfig.data.labels = osLabels;
                osConfig.data.datasets[0].data = osData;
                osConfig.data.scales =
                    window.orderStatistics = new Chart(document.getElementById("order-statistics-chart").getContext("2d"), osConfig);
                //   } else {
                //       window.orderStatistics.config.data.labels = osLabels;
                //      window.orderStatistics.config.data.datasets[0].data = osData;
                //     window.orderStatistics.update();
                // }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                //   alert(textStatus);
            }
        });
    }

    function ShowSetDefaultWork() {

        $.get("Work/ViewWorks/", function (result) {
            $("#myModal").modal('show');
            $("#myModalLabel").html(" @_SudeSessionContext.GetLocalResourceValue("Page.Content.SelectWork")");
            $("#myModalBody").html(result);

        });

    }

</script>

@section Modals
{
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body" id="myModalBody">

                </div>
            </div>
        </div>
    </div>
    <!--End Modal -->
}
<!-- /.row -->